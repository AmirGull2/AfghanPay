<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Home - ZaroRatPay</title>
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<div class="card" id="profileCard">
  <img id="profilePhoto" src="https://via.placeholder.com/100" alt="Profile Photo">
  <h2 id="userName">Hello, User</h2>
  <p id="userUsername">@username</p>
</div>

<div class="menu">
  <button onclick="location.href='leaderboard.html'">Leaderboard</button>
  <button onclick="location.href='deposit.html'">Deposit / Wallet</button>
  <button onclick="location.href='settings.html'">Settings</button>
  <button onclick="location.href='profile.html'">Profile</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();
  const user = tg.initDataUnsafe.user;

  document.getElementById('userName').innerText = `Hello, ${user.first_name}`;
  document.getElementById('userUsername').innerText = user.username ? `@${user.username}` : '';
  if(user.photo_url) document.getElementById('profilePhoto').src = user.photo_url;

  // Firebase: ذخیره کارونکي که نوی وي
  const userRef = db.collection("users").doc(user.id);
  userRef.get().then(doc => {
    if(!doc.exists){
      userRef.set({
        id: user.id,
        first_name: user.first_name,
        last_name: user.last_name || "",
        username: user.username || "",
        balance: 0
      });
    }
  });
</script>

</body>
</html>
