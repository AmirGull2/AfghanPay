<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timuri Reward Center</title>

<!-- Telegram WebApp SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Firebase SDK -->
<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
  import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDCcKpU-6lPnjn7NSTZVq6R5HGLac2GlAk",
    authDomain: "zaroratpay.firebaseapp.com",
    databaseURL: "https://zaroratpay-default-rtdb.firebaseio.com",
    projectId: "zaroratpay",
    storageBucket: "zaroratpay.firebasestorage.app",
    messagingSenderId: "992212281257",
    appId: "1:992212281257:web:bf5e442cc2636725ee06b8",
    measurementId: "G-51VT4W8MYZ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Telegram User
  const tg = window.Telegram.WebApp;
  tg.expand();

  let user = tg.initDataUnsafe?.user;

  window.addEventListener("load", async () => {
    if (user) {
      document.getElementById("username").innerText = user.first_name + " " + (user.last_name || "");
      document.getElementById("profilePic").src = user.photo_url || "https://i.imgur.com/nZNd7wC.png";

      const userRef = ref(db, "users/" + user.id);
      const snap = await get(userRef);
      if (!snap.exists()) {
        await set(userRef, { name: user.first_name, balance: 0, adsWatched: 0 });
      } else {
        document.getElementById("balance").innerText = snap.val().balance.toFixed(2);
      }
    }
  });

  // Rewarded Ad button handler
  window.watchAd = async function () {
    try {
      // Show Monetag Ad
      show_10102842().then(async () => {
        alert("‚úÖ Ad completed! +0.15 AFN added.");
        if (user) {
          const userRef = ref(db, "users/" + user.id);
          const snap = await get(userRef);
          let newBal = (snap.val().balance || 0) + 0.15;
          await update(userRef, { balance: newBal, adsWatched: (snap.val().adsWatched || 0) + 1 });
          document.getElementById("balance").innerText = newBal.toFixed(2);
        }
      });
    } catch (e) {
      console.error(e);
      alert("‚ö†Ô∏è Failed to show ad, try again later.");
    }
  };
</script>

<!-- Monetag SDK -->
<script src="//libtl.com/sdk.js" data-zone="10102842" data-sdk="show_10102842"></script>

<style>
  body {
    font-family: 'Poppins', sans-serif;
    text-align: center;
    background: linear-gradient(180deg, #1f2937, #111827);
    color: white;
    margin: 0;
    padding: 0;
  }
  header {
    background: #0f172a;
    padding: 15px;
    font-size: 20px;
    font-weight: bold;
    color: #00ffcc;
  }
  img {
    width: 100px; height: 100px;
    border-radius: 50%;
    margin: 10px auto;
    display: block;
  }
  .card {
    background: #1e293b;
    border-radius: 15px;
    padding: 20px;
    margin: 15px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
  }
  button {
    background: #00ffcc;
    color: #111;
    border: none;
    padding: 12px 25px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    margin-top: 10px;
  }
  button:hover { background: #00e6b3; }
</style>
</head>

<body>
<header>üí∞ Timuri Reward App</header>

<img id="profilePic" src="https://i.imgur.com/nZNd7wC.png" alt="Profile">
<h3 id="username">Loading...</h3>

<div class="card">
  <h2>Balance: <span id="balance">0.00</span> AFN</h2>
  <button onclick="watchAd()">üé• Watch Ad & Earn 0.15 AFN</button>
</div>

<footer style="margin-top:30px; font-size:13px; opacity:0.7;">
  Powered by Monetag ‚Ä¢ Timuri Team üá¶üá´
</footer>

</body>
</html>
