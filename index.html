<!doctype html>
<html lang="ps">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AzadPay Mini App ‚Äî Timuri Reward</title>

<!-- Telegram WebApp SDK -->
<script async src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Monetag SDK dynamically -->
<script>
(function(){
  const z = '10102842';
  const s = document.createElement('script');
  s.src = '//libtl.com/sdk.js';
  s.setAttribute('data-zone', z);
  s.setAttribute('data-sdk', 'show_' + z);
  s.async = true;
  document.head.appendChild(s);
})();
</script>

<style>
:root{
  --bg1:#0b1220; --bg2:#071428; --card:#081827; --accent:#00c853; --muted:#9fb3c8; --maxw:460px;
}
*{box-sizing:border-box}
body{margin:0;font-family:'Inter', Arial, sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#e6f0f6;display:flex;justify-content:center;padding:18px}
.app{width:100%;max-width:var(--maxw)}
.splash{padding:22px;border-radius:14px;text-align:center;background:linear-gradient(135deg,#06293a,#09324a);box-shadow:0 10px 30px rgba(2,6,23,0.6)}
h1{margin:6px 0 4px;font-size:20px}
.small{font-size:13px;color:var(--muted)}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:12px;border-radius:12px;margin-top:12px}
.profile{display:flex;gap:12px;align-items:center}
.avatar{width:72px;height:72px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.06)}
.btn{cursor:pointer;border:0;padding:12px 16px;border-radius:10px;font-weight:700;transition:all 0.2s;}
.btn:hover{opacity:0.9;}
.btn-primary{background:var(--accent);color:#002;box-shadow:0 6px 18px rgba(0,200,83,0.12)}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
.nav{display:flex;gap:8px;position:fixed;left:50%;transform:translateX(-50%);bottom:12px;max-width:var(--maxw);width:100%;padding:6px}
.nav button{flex:1}
input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:8px}
.row{display:flex;gap:8px}
.tx-item{padding:8px;border-bottom:1px solid rgba(255,255,255,0.02);font-size:14px}
.muted{color:var(--muted);font-size:13px}
.hidden{display:none !important;}
footer{margin-top:12px;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="app">

  <!-- Splash / Header -->
  <div id="splash" class="splash">
    <h1>AzadPay ‚Äî Timuri Rewards</h1>
    <p class="small">Open inside Telegram (@azad_pay_bot) for auto-login, ads & rewards</p>
    <div style="margin-top:12px">
      <button class="btn btn-primary" onclick="enterApp()">Open App</button>
      <button class="btn btn-ghost" onclick="openBot()">Open Bot</button>
    </div>
  </div>

  <!-- Main -->
  <div id="main" class="hidden">

    <!-- Profile + quick actions -->
    <div class="card">
      <div class="profile">
        <img id="profilePhoto" class="avatar" src="https://i.ibb.co/fxLwLrR/user.png" alt="photo">
        <div style="flex:1">
          <div id="profileName" style="font-weight:700">Guest</div>
          <div id="profileUsername" class="small"></div>
          <div class="small">Balance: <strong id="balance">0.00</strong> AFN</div>
          <div class="small">Ads today: <span id="adsToday">0</span>/100</div>
        </div>
      </div>

      <div style="margin-top:12px" class="row">
        <button class="btn btn-primary" id="watchAdBtn">‚ñ∂Ô∏é Watch Video ‚Äî Earn 0.15 AFN</button>
        <button class="btn btn-ghost" onclick="claimDailyBonus()">üéÅ Daily Bonus</button>
      </div>
      <div id="quickMsg" class="small muted" style="margin-top:8px">Invite friends ‚Äî get 2 AFN per user</div>
    </div>

    <!-- Home -->
    <div id="home" class="card">
      <h3>Home</h3>
      <p class="small">Watch rewarded videos, earn balance, then Top-up or Withdraw.</p>

      <div style="margin-top:10px">
        <h4 class="small">Mobile Top-up</h4>
        <label class="small">Operator</label>
        <select id="operator">
          <option>Roshan</option>
          <option>AWCC</option>
          <option>MTN</option>
          <option>Etisalat</option>
        </select>
        <label class="small">Phone number</label>
        <input id="topupPhone" placeholder="07XXXXXXXX" />
        <label class="small">Amount (AFN) ‚Äî minimum 25</label>
        <input id="topupAmount" type="number" min="25" value="25" />
        <div class="row" style="margin-top:8px">
          <button class="btn btn-primary" onclick="doTopup()">Top-up Now</button>
          <button class="btn btn-ghost" onclick="showSection('wallet')">View Wallet</button>
        </div>
        <div id="topupStatus" class="small muted" style="margin-top:8px"></div>
      </div>
    </div>

    <!-- Wallet -->
    <div id="wallet" class="card hidden">
      <h3>Wallet & Transactions</h3>
      <div class="small">Balance: <strong id="walletBalance">0.00</strong> AFN</div>
      <div style="margin-top:12px">
        <h4 class="small">Transactions</h4>
        <div id="txList" class="small">Loading...</div>
      </div>

      <div style="margin-top:12px">
        <h4 class="small">Withdraw</h4>
        <label class="small">Destination (AfghanPay/Mobile)</label>
        <input id="withdrawTo" placeholder="Account / Mobile number" />
        <label class="small">Amount (AFN)</label>
        <input id="withdrawAmount" type="number" min="1" value="100" />
        <div style="margin-top:8px" class="row">
          <button class="btn btn-primary" onclick="requestWithdraw()">Request Withdraw</button>
          <button class="btn btn-ghost" onclick="showSection('home')">Cancel</button>
        </div>
        <div id="withdrawStatus" class="small muted" style="margin-top:8px"></div>
      </div>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboard" class="card hidden">
      <h3>Leaderboard ‚Äî Top Earners</h3>
      <div id="leaderboardList" class="small">Loading...</div>
    </div>

    <!-- Referral -->
    <div id="referral" class="card hidden">
      <h3>Referral</h3>
      <div class="small">Invite friends and get <strong>2 AFN</strong> per user (one-time).</div>
      <div style="margin-top:8px" class="small">Your referral link:</div>
      <div style="margin-top:8px"><input id="refLink" readonly /></div>
      <div style="margin-top:8px" class="small">Referred users:</div>
      <div id="referredList" class="small">Loading...</div>
    </div>

    <!-- Settings -->
    <div id="settings" class="card hidden">
      <h3>Settings</h3>
      <label class="small">Display Name</label>
      <input id="setName" placeholder="Your name" />
      <div class="row" style="margin-top:8px">
        <button class="btn btn-primary" onclick="saveSettings()">Save</button>
        <button class="btn btn-ghost" onclick="resetName()">Reset</button>
      </div>
      <div id="settingsMsg" class="small muted" style="margin-top:8px"></div>
    </div>

  </div>

  <div class="nav">
    <button class="btn btn-ghost" onclick="showSection('home')">Home</button>
    <button class="btn btn-ghost" onclick="showSection('leaderboard')">Leaderboard</button>
    <button class="btn btn-ghost" onclick="showSection('wallet')">Wallet</button>
    <button class="btn btn-ghost" onclick="showSection('referral')">Referral</button>
    <button class="btn btn-ghost" onclick="showSection('settings')">Settings</button>
  </div>

  <footer>¬© AzadPay ‚Ä¢ @azad_pay_bot</footer>
</div>

<script>
/* CONFIG */
const ZONE_ID = '10102842';
const REWARD = 0.15;
const DAILY_LIMIT = 100;
const REFERRAL_REWARD = 2.0;
const DAILY_BONUS = 1.0;

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyDCcKpU-6lPnjn7NSTZVq6R5HGLac2GlAk",
  authDomain: "zaroratpay.firebaseapp.com",
  databaseURL: "https://zaroratpay-default-rtdb.firebaseio.com",
  projectId: "zaroratpay",
  storageBucket: "zaroratpay.firebasestorage.app",
  messagingSenderId: "992212281257",
  appId: "1:992212281257:web:bf5e442cc2636725ee06b8",
  measurementId: "G-51VT4W8MYZ"
};
firebase.initializeApp(firebaseConfig);
const rdb = firebase.database();

/* Telegram */
let tg=null; try{ tg=window.Telegram.WebApp; tg.expand(); }catch(e){ tg=null; }

/* STATE */
let currentUser=null; let uid=null;
const splashEl=document.getElementById('splash');
const mainEl=document.getElementById('main');
const profilePhoto=document.getElementById('profilePhoto');
const profileName=document.getElementById('profileName');
const profileUsername=document.getElementById('profileUsername');
const balanceEl=document.getElementById('balance');
const adsTodayEl=document.getElementById('adsToday');
const watchAdBtn=document.getElementById('watchAdBtn');
const refLinkInput=document.getElementById('refLink');
const referredListEl=document.getElementById('referredList');
const leaderboardListEl=document.getElementById('leaderboardList');
const txListEl=document.getElementById('txList');
const walletBalanceEl=document.getElementById('walletBalance');

/* ---------- helpers ---------- */
function enterApp(){ splashEl.classList.add('hidden'); mainEl.classList.remove('hidden'); initApp(); }
function openBot(){ window.open('https://t.me/azad_pay_bot','_blank'); }
function showSection(id){
  ['home','wallet','leaderboard','referral','settings'].forEach(s=>document.getElementById(s).classList.toggle('hidden',s!==id));
  if(id==='wallet') loadTransactions();
  if(id==='leaderboard') loadLeaderboard();
  if(id==='referral') loadReferredList();
}

/* find ad fn */
function findAdFn(){
  const fn='show_'+ZONE_ID;
  if(window[fn] && typeof window[fn]==
